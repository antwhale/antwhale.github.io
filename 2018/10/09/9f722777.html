<!DOCTYPE html>
<html lang="en">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="详细讲解Stream的使用方法">
<meta property="og:type" content="article">
<meta property="og:title" content="Stream表达式语法">
<meta property="og:url" content="http://ifeve.com/">
<meta property="og:site_name" content="CAYZLH">
<meta property="og:description" content="详细讲解Stream的使用方法">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/uBgJF4.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/Kz1wEs.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/EcOtNh.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/H9VDBX.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/2JGFXm.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/e7TGdu.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/iC3J2q.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/8grjYJ.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/F5wQkI.jpg">
<meta property="article:published_time" content="2018-10-09T15:02:36.000Z">
<meta property="article:modified_time" content="2020-06-01T13:52:52.406Z">
<meta property="article:author" content="🐳Ant丶">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/uBgJF4.jpg">
    
    
      
        
          <link rel="shortcut icon" href="/blog/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/blog/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Stream表达式语法</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/blog/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/blog/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/blog/true" title="CAYZLH" type="application/atom+xml">
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/blog/">Home</a></li>
        
          <li><a href="/blog/archives/">Articles</a></li>
        
          <li><a href="/blog/about/">About</a></li>
        
          <li><a href="/blog/search/">Search</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/blog/2018/10/29/a7c2d6f3.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/blog/2018/10/09/26787cb3.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
<!--        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>-->
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous</span>
      <span id="i-next" class="info" style="display:none;">Next</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.cayzlh.com/2018/10/09/9f722777.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://www.cayzlh.com/2018/10/09/9f722777.html&text=Stream表达式语法"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.cayzlh.com/2018/10/09/9f722777.html&is_video=false&description=Stream表达式语法"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Stream表达式语法&body=Check out this article: https://www.cayzlh.com/2018/10/09/9f722777.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://www.cayzlh.com/2018/10/09/9f722777.html&name=Stream表达式语法&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.cayzlh.com/2018/10/09/9f722777.html&t=Stream表达式语法"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Stream%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">1.</span> <span class="toc-text">Stream初体验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%96%E6%9E%90Stream%E9%80%9A%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">剖析Stream通用语法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAStream"><span class="toc-number">2.</span> <span class="toc-text">创建Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Stream%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E6%9D%A5%E5%88%9B%E5%BB%BAStream"><span class="toc-number">2.1.</span> <span class="toc-text">使用Stream静态方法来创建Stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Collection%E5%AD%90%E7%B1%BB%E8%8E%B7%E5%8F%96Stream"><span class="toc-number">2.2.</span> <span class="toc-text">通过Collection子类获取Stream</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2Stream"><span class="toc-number">3.</span> <span class="toc-text">转换Stream</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%87%E8%81%9A%EF%BC%88Reduce%EF%BC%89Stream"><span class="toc-number">4.</span> <span class="toc-text">汇聚（Reduce）Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E6%B1%87%E8%81%9A"><span class="toc-number">4.1.</span> <span class="toc-text">可变汇聚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B1%87%E8%81%9A"><span class="toc-number">4.2.</span> <span class="toc-text">其他汇聚</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Stream表达式语法
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ifeve.com</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2018-10-09T15:02:36.000Z" itemprop="datePublished">2018-10-09</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/blog/categories/Java/">Java</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/blog/tags/Java/" rel="tag">Java</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>本文转自：<a target="_blank" rel="external nofollow noopener noreferrer" href="http://ifeve.com/">ifeve.com</a></p>
</blockquote>
<h1 id="Stream初体验"><a href="#Stream初体验" class="headerlink" title="Stream初体验"></a>Stream初体验</h1><blockquote>
<p>A sequence of elements supporting sequential and parallel aggregate operations.</p>
<p>以上是Java里面是对Stream的定义，解读一下这句话：</p>
<ol>
<li><strong>Stream是元素的集合，这点让Stream看起来用些类似Iterator；</strong></li>
<li><strong>可以支持顺序和并行的对原Stream进行汇聚的操作；</strong></li>
</ol>
</blockquote>
<p><strong>可以把Stream当成一个高级版本的Iterator。</strong></p>
<p><strong>原始版本的Iterator，用户只能一个一个的遍历元素并对其执行某些操作；</strong></p>
<p><strong>高级版本的Stream，用户只要给出需要对其包含的元素执行什么操作，比如“过滤掉长度大于10的字符串”、“获取每个字符串的首字母”等，具体这些操作如何应用到每个元素上，就给Stream就好了！</strong></p>
<p>下面一段代码直观的认识一下Stream：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Lists是Guava中的一个工具类</span></span><br><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">6</span>);</span><br><span class="line">nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).count();</span><br></pre></td></tr></table></figure>
<p>上面这段代码是获取一个List中，元素不为null的个数。我们现在开始深入解刨这个例子，完成以后你可能可以基本掌握Stream的用法！</p>
<h2 id="剖析Stream通用语法"><a href="#剖析Stream通用语法" class="headerlink" title="剖析Stream通用语法"></a>剖析Stream通用语法</h2><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/uBgJF4.jpg" alt="剖析Stream通用语法"></p>
<p>图片就是对于Stream例子的一个解析，可以很清楚的看见：原本一条语句被三种颜色的框分割成了三个部分。</p>
<p>红色框中的语句是一个Stream的生命开始的地方，负责创建一个Stream实例；</p>
<p>绿色框中的语句是赋予Stream灵魂的地方，把一个Stream转换成另外一个Stream，红框的语句生成的是一个包含所有nums变量的Stream，进过绿框的filter方法以后，重新生成了一个过滤掉原nums列表所有null以后的Stream；</p>
<p>蓝色框中的语句是丰收的地方，把Stream的里面包含的内容按照某种算法来汇聚成一个值，例子中是获取Stream中包含的元素个数。</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/Kz1wEs.jpg" alt="剖析Stream通用语法"></p>
<p>在此我们总结一下<strong>使用Stream的基本步骤：</strong></p>
<ol>
<li>创建Stream；</li>
<li>转换Stream，每次转换原有Stream对象不改变，返回一个新的Stream对象（<strong>可以有多次转换</strong>）；</li>
<li>对Stream进行聚合（Reduce）操作，获取想要的结果；</li>
</ol>
<h1 id="创建Stream"><a href="#创建Stream" class="headerlink" title="创建Stream"></a>创建Stream</h1><p>最常用的创建Stream有两种途径：</p>
<ol>
<li>通过Stream接口的静态工厂方法（注意：Java8里接口可以带静态方法）；</li>
<li>通过Collection接口的默认方法（默认方法：Default method，也是Java8中的一个新特性，就是接口中的一个带有实现的方法）–stream()，把一个Collection对象转换成Stream</li>
</ol>
<h2 id="使用Stream静态方法来创建Stream"><a href="#使用Stream静态方法来创建Stream" class="headerlink" title="使用Stream静态方法来创建Stream"></a>使用Stream静态方法来创建Stream</h2><ol>
<li><p>of方法：有两个overload方法，一个接受变长参数，一个接口单一值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">Stream&lt;String&gt; stringStream = Stream.of(<span class="string">&quot;taobao&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>generator方法：生成一个无限长度的Stream，其元素的生成是通过给定的Supplier（这个接口可以看成一个对象的工厂，每次调用返回一个给定类型的对象）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stream.generate(<span class="keyword">new</span> Supplier&lt;Double&gt;() &#123;</span><br><span class="line">   	<span class="meta">@Override</span></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> Double <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Math.random();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Stream.generate(() -&gt; Math.random());</span><br><span class="line">Stream.generate(Math::random);</span><br></pre></td></tr></table></figure>
<p>三条语句的作用都是一样的，只是使用了lambda表达式和方法引用的语法来简化代码。每条语句其实都是生成一个无限长度的Stream，其中值是随机的。<em>这个无限长度Stream是懒加载，一般这种无限长度的Stream都会配合Stream的limit()方法来用。</em></p>
</li>
<li><p>iterate方法：也是生成无限长度的Stream，和generator不同的是，其元素的生成是重复对给定的种子值(seed)调用用户指定函数来生成的。其中包含的元素可以认为是：seed，f(seed),f(f(seed))无限循环</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.iterate(<span class="number">1</span>, item -&gt; item + <span class="number">1</span>).limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p>这段代码就是先获取一个无限长度的正整数集合的Stream，然后取出前10个打印。<strong>千万记住使用limit方法，不然会无限打印下去。</strong></p>
</li>
</ol>
<h2 id="通过Collection子类获取Stream"><a href="#通过Collection子类获取Stream" class="headerlink" title="通过Collection子类获取Stream"></a>通过Collection子类获取Stream</h2><p>查看Java doc就可以发现Collection接口有一个stream方法，所以其所有子类都都可以获取对应的Stream对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Iterable</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//其他方法省略</span></span><br><span class="line">	<span class="function"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.stream(spliterator(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="转换Stream"><a href="#转换Stream" class="headerlink" title="转换Stream"></a>转换Stream</h1><p>转换Stream其实就是把一个Stream通过某些行为转换成一个新的Stream。Stream接口中定义了几个常用的转换方法，下面挑选几个常用的转换方法来解释。</p>
<ol>
<li><p><code>distinct</code>: 对于Stream中包含的元素进行去重操作（去重逻辑依赖元素的equals方法），新生成的Stream中没有重复的元素；</p>
<p>distinct方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/EcOtNh.jpg" alt="distinct方法示意图"></p>
</li>
<li><p><code>filter</code>: 对于Stream中包含的元素使用给定的过滤函数进行过滤操作，新生成的Stream只包含符合条件的元素；</p>
<p>filter方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/H9VDBX.jpg" alt="filter方法示意图"></p>
</li>
<li><p><code>map</code>: 对于Stream中包含的元素使用给定的转换函数进行转换操作，新生成的Stream只包含转换生成的元素</p>
<p>这个方法有三个对于原始类型的变种方法，分别是：<code>mapToInt</code>，<code>mapToLong</code>和<code>mapToDouble</code>。这三个方法也比较好理解，比如<code>mapToInt</code>就是把原始<code>Stream</code>转换成一个新的<code>Stream</code>，这个新生成的<code>Stream</code>中的元素都是<code>int</code>类型。之所以会有这样三个变种方法，可以免除自动装箱/拆箱的额外消耗；</p>
<p>map方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/2JGFXm.jpg" alt="map方法示意图"></p>
</li>
<li><p><code>flatMap</code>：和<code>map</code>类似，不同的是其每个元素转换得到的是Stream对象，会把子Stream中的元素压缩到父集合中；</p>
<p>flatMap方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/e7TGdu.jpg" alt="`flatMap`方法示意图"></p>
</li>
<li><p><code>peek</code>: 生成一个包含原Stream的所有元素的新Stream，同时会提供一个消费函数（Consumer实例），新Stream每个元素被消费的时候都会执行给定的消费函数；</p>
<p>peek方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/iC3J2q.jpg" alt="peek方法示意图"></p>
</li>
<li><p><code>limit</code>: 对一个Stream进行截断操作，获取其前N个元素，如果原Stream中包含的元素个数小于N，那就获取其所有的元素；</p>
<p>limit方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/8grjYJ.jpg" alt="limit方法示意图"></p>
</li>
<li><p><code>skip</code>: 返回一个丢弃原Stream的前N个元素后剩下元素组成的新Stream，如果原Stream中包含的元素个数小于N，那么返回空Stream；</p>
<p>skip方法示意图：</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/F5wQkI.jpg" alt="skip方法示意图"></p>
</li>
<li><p>综合使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(“sum is:”+nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">   			distinct().mapToInt(num -&gt; num * <span class="number">2</span>).</span><br><span class="line">               peek(System.out::println).skip(<span class="number">2</span>).limit(<span class="number">4</span>).sum());   </span><br></pre></td></tr></table></figure>
<p>这段代码演示了上面介绍的所有转换方法（除了flatMap）。</p>
<p>简单解释一下这段代码的含义：给定一个<code>Integer</code>类型的<code>List</code>，获取其对应的Stream对象，然后进行过滤掉null，再去重，再每个元素乘以2，再每个元素被消费的时候打印自身，在跳过前两个元素，最后去前四个元素进行加和运算(解释一大堆，很像废话，因为基本看了方法名就知道要做什么了。这个就是声明式编程的一大好处！)。</p>
</li>
<li><p>性能问题</p>
<p>可能会有这样的疑问：在对于一个Stream进行多次转换操作，每次都对Stream的每个元素进行转换，而且是执行多次，这样时间复杂度就是一个for循环里把所有操作都做掉的N（转换的次数）倍啊。<strong>其实不是这样的，转换操作都是<code>lazy</code>的，多个转换操作只会在汇聚操作的时候融合起来，一次循环完成。可以这样简单的理解，Stream里有个操作函数的集合，每次转换操作就是把转换函数放入这个集合中，在汇聚操作的时候循环Stream对应的集合，然后对每个元素执行所有的函数。</strong></p>
</li>
</ol>
<h1 id="汇聚（Reduce）Stream"><a href="#汇聚（Reduce）Stream" class="headerlink" title="汇聚（Reduce）Stream"></a>汇聚（Reduce）Stream</h1><p><strong>Java doc中对于其定义：</strong></p>
<blockquote>
<p>A reduction operation (also called a fold) takes a sequence of input elements and combines them into a single summary result by repeated application of a combining operation, such as finding the sum or maximum of a set of numbers, or accumulating elements into a list. The streams classes have multiple forms of general reduction operations, called reduce() and collect(), as well as multiple specialized reduction forms such as sum(), max(), or count().</p>
<p>汇聚操作（也称为折叠）接受一个元素序列为输入，反复使用某个合并操作，把序列中的元素合并成一个汇总的结果。比如查找一个数字列表的总和或者最大值，或者把这些数字累积成一个List对象。Stream接口有一些通用的汇聚操作，比如reduce()和collect()；也有一些特定用途的汇聚操作，比如sum(),max()和count()。<strong>注意：sum方法不是所有的Stream对象都有的，只有IntStream、LongStream和DoubleStream是实例才有。</strong></p>
</blockquote>
<p>分两部分来介绍汇聚操作：</p>
<ol>
<li><strong>可变汇聚</strong>：把输入的元素们累积到一个可变的容器中，比如Collection或者StringBuilder；</li>
<li><strong>其他汇聚</strong>：除去可变汇聚剩下的，一般都不是通过反复修改某个可变对象，而是通过把前一次的汇聚结果当成下一次的入参，反复如此。比如reduce，count，allMatch；</li>
</ol>
<h2 id="可变汇聚"><a href="#可变汇聚" class="headerlink" title="可变汇聚"></a>可变汇聚</h2><p>可变汇聚对应的只有一个方法：collect，正如其名字显示的，它可以把Stream中的要有元素收集到一个结果容器中（比如Collection）。先看一下最通用的collect方法的定义（还有其他override方法）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;R&gt; <span class="function">R <span class="title">collect</span><span class="params">(Supplier&lt;R&gt; supplier,</span></span></span><br><span class="line"><span class="function"><span class="params">                  BiConsumer&lt;R, ? <span class="keyword">super</span> T&gt; accumulator,</span></span></span><br><span class="line"><span class="function"><span class="params">                  BiConsumer&lt;R, R&gt; combiner)</span></span>;</span><br></pre></td></tr></table></figure>
<p>先来看看这三个参数的含义：</p>
<p><code>Supplier supplier</code>是一个工厂函数，用来生成一个新的容器；</p>
<p><code>BiConsumer accumulator</code>也是一个函数，用来把Stream中的元素添加到结果容器中；</p>
<p><code>BiConsumer combiner</code>还是一个函数，用来把中间状态的多个结果容器合并成为一个（并发的时候会用到）；</p>
<p>来段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">       List&lt;Integer&gt; numsWithoutNull = nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">               collect(() -&gt; <span class="keyword">new</span> ArrayList&lt;Integer&gt;(),</span><br><span class="line">                       (list, item) -&gt; list.add(item),</span><br><span class="line">                       (list1, list2) -&gt; list1.addAll(list2));</span><br></pre></td></tr></table></figure>
<p>上面这段代码就是对一个元素是Integer类型的List，先过滤掉全部的null，然后把剩下的元素收集到一个新的List中。进一步看一下collect方法的三个参数，都是lambda形式的函数。</p>
<ul>
<li>第一个函数生成一个新的ArrayList实例；</li>
<li>第二个函数接受两个参数，第一个是前面生成的ArrayList对象，二个是stream中包含的元素，函数体就是把stream中的元素加入ArrayList对象中。第二个函数被反复调用直到原stream的元素被消费完毕；</li>
<li>第三个函数也是接受两个参数，这两个都是ArrayList类型的，函数体就是把第二个ArrayList全部加入到第一个中；</li>
</ul>
<p>但是上面的collect方法调用也有点太复杂了，来看一下collect方法另外一个override的版本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;R, A&gt; <span class="function">R <span class="title">collect</span><span class="params">(Collector&lt;? <span class="keyword">super</span> T, A, R&gt; collector)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>Java8还给我们提供了Collector的工具类，其中已经定义了一些静态工厂方法，比如：Collectors.toCollection()收集到Collection中, Collectors.toList()收集到List中和Collectors.toSet()收集到Set中。</strong></p>
<p>使用Collectors对于代码的简化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numsWithoutNull = nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">                collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<h2 id="其他汇聚"><a href="#其他汇聚" class="headerlink" title="其他汇聚"></a>其他汇聚</h2><ul>
<li><strong>reduce方法：</strong>reduce方法非常的通用，后面介绍的count，sum等都可以使用其实现。</li>
</ul>
<p>reduce方法的第一种形式，其方法定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Optional&lt;T&gt; <span class="title">reduce</span><span class="params">(BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br></pre></td></tr></table></figure>
<p>接受一个BinaryOperator类型的参数，在使用的时候可以用lambda表达式来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().reduce((sum, item) -&amp;gt; sum + item).get());</span><br></pre></td></tr></table></figure>
<p>可以看到reduce方法接受一个函数，这个函数有两个参数，第一个参数是上次函数执行的返回值（也称为中间结果），第二个参数是stream中的元素，这个函数把这两个值相加，得到的和会被赋值给下次执行这个函数的第一个参数。要注意的是：<strong>第一次执行的时候第一个参数的值是Stream的第一个元素，第二个参数是Stream的第二个元素</strong>。这个方法返回值类型是Optional，这是Java8防止出现NPE的一种可行方法，后面的文章会详细介绍，这里就简单的认为是一个容器，其中可能会包含0个或者1个对象。</p>
<p><strong>reduce方法还有一个很常用的变种：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">reduce</span><span class="params">(T identity, BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这个定义上上面已经介绍过的基本一致，不同的是：它允许用户提供一个循环计算的初始值，如果Stream为空，就直接返回该值。而且这个方法不会返回Optional，因为其不会出现null值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().reduce(<span class="number">0</span>, (sum, item) -&gt; sum + item));</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>count方法：</strong>获取Stream中元素的个数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().count());</span><br></pre></td></tr></table></figure>
<hr>
<p>其他方法：</p>
<ul>
<li><strong>allMatch：</strong>是不是Stream中的所有元素都满足给定的匹配条件</li>
<li><strong>anyMatch：</strong>Stream中是否存在任何一个元素满足匹配条件</li>
<li><strong>findFirst：</strong> 返回Stream中的第一个元素，如果Stream为空，返回空Optional</li>
<li><strong>noneMatch：</strong>是不是Stream中的所有元素都不满足给定的匹配条件</li>
<li><strong>max和min：</strong>使用给定的比较器（Operator），返回Stream中的最大|最小值</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://ifeve.com/">ifeve.com</a></li>
<li>《Java SE 8 for the Really Impatient》</li>
<li>Java 8 Tutorial</li>
<li>Java 8 API doc</li>
</ul>

  </div>

  
    <div style="text-align:center;width:100%">
      <img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/640-2.gif">
    </div>
  

  
    <div>
      <h4>版权声明</h4>
      <pre>
        
        <strong>本文来源： </strong><a href="http://ifeve.com" title="ifeve.com" rel="external nofollow noopener noreferrer" target="_blank">http://ifeve.com</a>

        <strong>本文链接：</strong><a href="https://www.cayzlh.com/2018/10/09/9f722777.html" title="/blog/Stream%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E6%B3%95">https://www.cayzlh.com/2018/10/09/9f722777.html</a>

        <strong>版权声明： </strong>
        
          文章内容仅用作学习和分享，转载请注明出处
        
      </pre>
    </div>
  

</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/blog/">Home</a></li>
        
          <li><a href="/blog/archives/">Articles</a></li>
        
          <li><a href="/blog/about/">About</a></li>
        
          <li><a href="/blog/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Stream%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">1.</span> <span class="toc-text">Stream初体验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%96%E6%9E%90Stream%E9%80%9A%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">剖析Stream通用语法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAStream"><span class="toc-number">2.</span> <span class="toc-text">创建Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Stream%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E6%9D%A5%E5%88%9B%E5%BB%BAStream"><span class="toc-number">2.1.</span> <span class="toc-text">使用Stream静态方法来创建Stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Collection%E5%AD%90%E7%B1%BB%E8%8E%B7%E5%8F%96Stream"><span class="toc-number">2.2.</span> <span class="toc-text">通过Collection子类获取Stream</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2Stream"><span class="toc-number">3.</span> <span class="toc-text">转换Stream</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%87%E8%81%9A%EF%BC%88Reduce%EF%BC%89Stream"><span class="toc-number">4.</span> <span class="toc-text">汇聚（Reduce）Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E6%B1%87%E8%81%9A"><span class="toc-number">4.1.</span> <span class="toc-text">可变汇聚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B1%87%E8%81%9A"><span class="toc-number">4.2.</span> <span class="toc-text">其他汇聚</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.cayzlh.com/2018/10/09/9f722777.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://www.cayzlh.com/2018/10/09/9f722777.html&text=Stream表达式语法"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.cayzlh.com/2018/10/09/9f722777.html&is_video=false&description=Stream表达式语法"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Stream表达式语法&body=Check out this article: https://www.cayzlh.com/2018/10/09/9f722777.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://www.cayzlh.com/2018/10/09/9f722777.html&title=Stream表达式语法"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://www.cayzlh.com/2018/10/09/9f722777.html&name=Stream表达式语法&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.cayzlh.com/2018/10/09/9f722777.html&t=Stream表达式语法"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
<!--        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>-->
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    CAYZLH &copy;
    
    
    2019-2021
    粤ICP备20058712号-1
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
          <li><a href="/blog/tools/">tools</a></li>
        
          <li><a href="/blog/links/">links</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/blog/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/blog/lib/jquery/jquery.min.js"></script>


<script src="/blog/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/blog/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/blog/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129095667-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-129095667-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
